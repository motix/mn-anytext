{"version":3,"sources":["components/singleLineInput.js"],"names":["SingleLineInputSchema","spec","defaultSpec","nodes","doc","content","div","parseDOM","tag","toDOM","text","Schema","SingleLineInputState","config","schema","node","value","EditorState","SingleLineInputView","place","props","state","plugins","placeholder","decorations","prefix","decoration","Decoration","firstChild","nodeSize","push","suffix","DecorationSet","create","tr","descendants","pos","isTextblock","insertText","size","dispatch","docChanged","onChange","bind","EditorView","SingleLineInput","String","wrapping","i","view","isFirefox","navigator","userAgent","toLowerCase","indexOf","dom","style","whiteSpace","textContent","updateValue"],"mappings":"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","sourcesContent":["import { Schema } from 'prosemirror-model';\r\nimport { EditorState } from 'prosemirror-state';\r\nimport { EditorView } from 'prosemirror-view';\r\nimport { Decoration, DecorationSet } from 'prosemirror-view';\r\nimport placeholder from '../plugins/placeholder';\r\n\r\nexport class SingleLineInputSchema extends Schema {\r\n    constructor(spec) {\r\n        const defaultSpec = {\r\n            nodes: {\r\n                doc: { content: 'div' },\r\n                div: {\r\n                    content: 'text*',\r\n                    parseDOM: [{ tag: 'div' }],\r\n                    toDOM() { return ['div', 0]; }\r\n                },\r\n                text: {}\r\n            }\r\n        };\r\n        spec = {\r\n            ...defaultSpec,\r\n            ...spec\r\n        };\r\n\r\n        super(spec);\r\n    }\r\n}\r\n\r\nexport class SingleLineInputState extends EditorState {\r\n    static create(config) {\r\n        config.schema = config.schema ||\r\n            (config.doc ? config.doc.schema : new SingleLineInputSchema());\r\n\r\n        config.doc = config.doc ||\r\n            config.schema.node('doc', null, [config.schema.node('div', null, config.value ? [config.schema.text(config.value)] : [])]);\r\n\r\n        return super.create(config);\r\n    }\r\n}\r\n\r\nexport class SingleLineInputView extends EditorView {\r\n    constructor(place, props) {\r\n        if (!props.state) {\r\n            const plugins = [\r\n                placeholder(props.placeholder || {})\r\n            ];\r\n\r\n            const decorations = function ({ doc }) {\r\n                const decorations = [];\r\n\r\n                if (props.prefix) {\r\n                    const decoration = Decoration.node(0, doc.firstChild.nodeSize, {\r\n                        'data-prefix-text': props.prefix\r\n                    });\r\n                    decorations.push(decoration);\r\n                }\r\n\r\n                if (props.suffix) {\r\n                    const decoration = Decoration.node(0, doc.firstChild.nodeSize, {\r\n                        'data-suffix-text': props.suffix\r\n                    });\r\n                    decorations.push(decoration);\r\n                }\r\n\r\n                return DecorationSet.create(doc, decorations);\r\n            };\r\n\r\n            props.state = SingleLineInputState.create({ value: props.value, plugins: plugins });\r\n            props.decorations = decorations;\r\n        }\r\n\r\n        super(place, props);\r\n    }\r\n\r\n    updateValue(value) {\r\n        const tr = this.state.tr;\r\n        tr.doc.descendants((node, pos) => {\r\n            if (node.isTextblock) {\r\n                tr.insertText(value, pos + 1, pos + 1 + node.content.size);\r\n            }\r\n        });\r\n        this.dispatch(tr);\r\n    }\r\n\r\n    dispatch(tr) {\r\n        super.dispatch(tr);\r\n\r\n        if (tr.docChanged && this.props.onChange) {\r\n            this.props.onChange.bind(this)(this, tr);\r\n        }\r\n    }\r\n}\r\n\r\nexport class SingleLineInput {\r\n    constructor(place, props) {\r\n        props.value = typeof props.value === 'undefined' || props.value === null ? '' : String(props.value);\r\n        props.wrapping = typeof props.wrapping === 'undefined' || props.wrapping === null ? true : props.wrapping;\r\n\r\n        if (props.placeholder) {\r\n            for (let i in props.placeholder) {\r\n                if (typeof props.placeholder[i] === 'undefined' || props.placeholder[i] === null) {\r\n                    delete props.placeholder[i];\r\n                }\r\n            }\r\n        }\r\n\r\n        this.view = new SingleLineInputView(place, props);\r\n\r\n        const isFirefox = navigator.userAgent.toLowerCase().indexOf('firefox') > -1;\r\n        if (props.wrapping) {\r\n            this.view.dom.style.whiteSpace = isFirefox ? 'pre-wrap' : null;\r\n        } else {\r\n            this.view.dom.style.whiteSpace = isFirefox ? 'pre' : 'nowrap';\r\n        }\r\n    }\r\n\r\n    get value() {\r\n        return this.view.state.doc.textContent;\r\n    }\r\n\r\n    set value(value) {\r\n        value = typeof value === 'undefined' || value === null ? '' : String(value);\r\n        if (value !== this.value) {\r\n            this.view.updateValue(value);\r\n        }\r\n    }\r\n}"],"file":"singleLineInput.js"}